<Preprocess,"#include <linux/sched.h>">
<Preprocess,"#include <linux/kernel.h>">
<Preprocess,"#include <asm/segment.h>">
<Preprocess,"#include <string.h> ">
<Preprocess,"#include <fcntl.h>">
<Preprocess,"#include <errno.h>">
<Preprocess,"#include <const.h>">
<Preprocess,"#include <sys/stat.h>">
<Preprocess,"#define ACC_MODE(x) ("\004\002\006\377"[(x)&O_ACCMODE])">
<Preprocess,"#define MAY_EXEC 1">
<Preprocess,"#define MAY_WRITE 2">
<Preprocess,"#define MAY_READ 4">
<Keyword,"static">
<Keyword,"int">
<Identifier,"permission">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"inode">
<Comma,",">
<Keyword,"int">
<Identifier,"mask">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"int">
<Identifier,"mode">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<LogicAnd,"&&">
<LogicNot,"!">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<CloseParenthese,")">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<Identifier,"else">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"euid">
<Equal,"==">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_uid">
<CloseParenthese,")">
<Identifier,"mode">
<RightShiftAssign,">>=">
<Integer,"6">
<Semicolon,";">
<Identifier,"else">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"egid">
<Equal,"==">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_gid">
<CloseParenthese,")">
<Identifier,"mode">
<RightShiftAssign,">>=">
<Integer,"3">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Identifier,"mode">
<BitAnd,"&">
<Identifier,"mask">
<BitAnd,"&">
<Integer,"0007">
<CloseParenthese,")">
<Equal,"==">
<Identifier,"mask">
<CloseParenthese,")">
<LogicOr,"||">
<Identifier,"suser">
<OpenParenthese,"(">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Integer,"1">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"static">
<Keyword,"int">
<Identifier,"match">
<OpenParenthese,"(">
<Keyword,"int">
<Identifier,"len">
<Comma,",">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"name">
<Comma,",">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"register">
<Keyword,"int">
<Identifier,"same">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"de">
<LogicOr,"||">
<LogicNot,"!">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<LogicOr,"||">
<Identifier,"len">
<Larger,">">
<Identifier,"NAME_LEN">
<CloseParenthese,")">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"len">
<Less,"<">
<Identifier,"NAME_LEN">
<LogicAnd,"&&">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"name">
<OpenSquareBracket,"[">
<Identifier,"len">
<CloseSquareBracket,"]">
<CloseParenthese,")">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<Identifier,"__asm__">
<OpenParenthese,"(">
<String,"cld\n\t">
<String,"fs ; repe ; cmpsb\n\t">
<String,"setz %%al">
<Colon,":">
<String,"=a">
<OpenParenthese,"(">
<Identifier,"same">
<CloseParenthese,")">
<Colon,":">
<String,"0">
<OpenParenthese,"(">
<Integer,"0">
<CloseParenthese,")">
<Comma,",">
<String,"S">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Keyword,"long">
<CloseParenthese,")">
<Identifier,"name">
<CloseParenthese,")">
<Comma,",">
<String,"D">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Keyword,"long">
<CloseParenthese,")">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"name">
<CloseParenthese,")">
<Comma,",">
<String,"c">
<OpenParenthese,"(">
<Identifier,"len">
<CloseParenthese,")">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Identifier,"same">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"static">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"find_entry">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"name">
<Comma,",">
<Keyword,"int">
<Identifier,"namelen">
<Comma,",">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Mul,"*">
<Identifier,"res_dir">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"int">
<Identifier,"entries">
<Semicolon,";">
<Keyword,"int">
<Identifier,"block">
<Comma,",">
<Identifier,"i">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"super_block">
<Mul,"*">
<Identifier,"sb">
<Semicolon,";">
<Preprocess,"#ifdef NO_TRUNCATE">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"namelen">
<Larger,">">
<Identifier,"NAME_LEN">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Preprocess,"#else">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"namelen">
<Larger,">">
<Identifier,"NAME_LEN">
<CloseParenthese,")">
<Identifier,"namelen">
<Assign,"=">
<Identifier,"NAME_LEN">
<Semicolon,";">
<Preprocess,"#endif">
<Identifier,"entries">
<Assign,"=">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<PointerMember,"->">
<Identifier,"i_size">
<Div,"/">
<OpenParenthese,"(">
<Keyword,"sizeof">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<CloseParenthese,")">
<CloseParenthese,")">
<Semicolon,";">
<Mul,"*">
<Identifier,"res_dir">
<Assign,"=">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"namelen">
<Equal,"==">
<Integer,"2">
<LogicAnd,"&&">
<Identifier,"get_fs_byte">
<OpenParenthese,"(">
<Identifier,"name">
<CloseParenthese,")">
<Equal,"==">
<Char,".">
<LogicAnd,"&&">
<Identifier,"get_fs_byte">
<OpenParenthese,"(">
<Identifier,"name">
<Add,"+">
<Integer,"1">
<CloseParenthese,")">
<Equal,"==">
<Char,".">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<Equal,"==">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"root">
<CloseParenthese,")">
<Identifier,"namelen">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"else">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<PointerMember,"->">
<Identifier,"i_num">
<Equal,"==">
<Identifier,"ROOT_INO">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"sb">
<Assign,"=">
<Identifier,"get_super">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"sb">
<PointerMember,"->">
<Identifier,"s_imount">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<Assign,"=">
<Identifier,"sb">
<PointerMember,"->">
<Identifier,"s_imount">
<Semicolon,";">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<PointerMember,"->">
<Identifier,"i_count">
<Inc,"++">
<Semicolon,";">
<CloseBrace,"}">
<CloseBrace,"}">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"block">
<Assign,"=">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"bh">
<Assign,"=">
<Identifier,"bread">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"block">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Identifier,"i">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"de">
<Assign,"=">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<Semicolon,";">
<Keyword,"while">
<OpenParenthese,"(">
<Identifier,"i">
<Less,"<">
<Identifier,"entries">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Keyword,"char">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"de">
<LargerEqual,">=">
<Identifier,"BLOCK_SIZE">
<Add,"+">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"bh">
<Assign,"=">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"block">
<Assign,"=">
<Identifier,"bmap">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Identifier,"i">
<Div,"/">
<Identifier,"DIR_ENTRIES_PER_BLOCK">
<CloseParenthese,")">
<CloseParenthese,")">
<LogicOr,"||">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"bh">
<Assign,"=">
<Identifier,"bread">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Mul,"*">
<Identifier,"dir">
<CloseParenthese,")">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"block">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"i">
<AddAssign,"+=">
<Identifier,"DIR_ENTRIES_PER_BLOCK">
<Semicolon,";">
<Keyword,"continue">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<Assign,"=">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"match">
<OpenParenthese,"(">
<Identifier,"namelen">
<Comma,",">
<Identifier,"name">
<Comma,",">
<Identifier,"de">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Mul,"*">
<Identifier,"res_dir">
<Assign,"=">
<Identifier,"de">
<Semicolon,";">
<Keyword,"return">
<Identifier,"bh">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<Inc,"++">
<Semicolon,";">
<Identifier,"i">
<Inc,"++">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"static">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"add_entry">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"name">
<Comma,",">
<Keyword,"int">
<Identifier,"namelen">
<Comma,",">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Mul,"*">
<Identifier,"res_dir">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"int">
<Identifier,"block">
<Comma,",">
<Identifier,"i">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Mul,"*">
<Identifier,"res_dir">
<Assign,"=">
<Identifier,"NULL">
<Semicolon,";">
<Preprocess,"#ifdef NO_TRUNCATE">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"namelen">
<Larger,">">
<Identifier,"NAME_LEN">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Preprocess,"#else">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"namelen">
<Larger,">">
<Identifier,"NAME_LEN">
<CloseParenthese,")">
<Identifier,"namelen">
<Assign,"=">
<Identifier,"NAME_LEN">
<Semicolon,";">
<Preprocess,"#endif">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"block">
<Assign,"=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"bh">
<Assign,"=">
<Identifier,"bread">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"block">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Identifier,"i">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"de">
<Assign,"=">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<Semicolon,";">
<Keyword,"while">
<OpenParenthese,"(">
<Integer,"1">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Keyword,"char">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"de">
<LargerEqual,">=">
<Identifier,"BLOCK_SIZE">
<Add,"+">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"bh">
<Assign,"=">
<Identifier,"NULL">
<Semicolon,";">
<Identifier,"block">
<Assign,"=">
<Identifier,"create_block">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"i">
<Div,"/">
<Identifier,"DIR_ENTRIES_PER_BLOCK">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"block">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"bh">
<Assign,"=">
<Identifier,"bread">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"block">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"i">
<AddAssign,"+=">
<Identifier,"DIR_ENTRIES_PER_BLOCK">
<Semicolon,";">
<Keyword,"continue">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<Assign,"=">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"i">
<Mul,"*">
<Keyword,"sizeof">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<CloseParenthese,")">
<LargerEqual,">=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_size">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_size">
<Assign,"=">
<OpenParenthese,"(">
<Identifier,"i">
<Add,"+">
<Integer,"1">
<CloseParenthese,")">
<Mul,"*">
<Keyword,"sizeof">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_ctime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_mtime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Keyword,"for">
<OpenParenthese,"(">
<Identifier,"i">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"i">
<Less,"<">
<Identifier,"NAME_LEN">
<Semicolon,";">
<Identifier,"i">
<Inc,"++">
<CloseParenthese,")">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"name">
<OpenSquareBracket,"[">
<Identifier,"i">
<CloseSquareBracket,"]">
<Assign,"=">
<OpenParenthese,"(">
<Identifier,"i">
<Less,"<">
<Identifier,"namelen">
<CloseParenthese,")">
<Question,"?">
<Identifier,"get_fs_byte">
<OpenParenthese,"(">
<Identifier,"name">
<Add,"+">
<Identifier,"i">
<CloseParenthese,")">
<Colon,":">
<Integer,"0">
<Semicolon,";">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Mul,"*">
<Identifier,"res_dir">
<Assign,"=">
<Identifier,"de">
<Semicolon,";">
<Keyword,"return">
<Identifier,"bh">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<Inc,"++">
<Semicolon,";">
<Identifier,"i">
<Inc,"++">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"static">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"get_dir">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"pathname">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"char">
<Identifier,"c">
<Semicolon,";">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"thisname">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"int">
<Identifier,"namelen">
<Comma,",">
<Identifier,"inr">
<Comma,",">
<Identifier,"idev">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"root">
<LogicOr,"||">
<LogicNot,"!">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"root">
<PointerMember,"->">
<Identifier,"i_count">
<CloseParenthese,")">
<Identifier,"panic">
<OpenParenthese,"(">
<String,"No root inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"pwd">
<LogicOr,"||">
<LogicNot,"!">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"pwd">
<PointerMember,"->">
<Identifier,"i_count">
<CloseParenthese,")">
<Identifier,"panic">
<OpenParenthese,"(">
<String,"No cwd inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Identifier,"c">
<Assign,"=">
<Identifier,"get_fs_byte">
<OpenParenthese,"(">
<Identifier,"pathname">
<CloseParenthese,")">
<CloseParenthese,")">
<Equal,"==">
<Char,"/">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"inode">
<Assign,"=">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"root">
<Semicolon,";">
<Identifier,"pathname">
<Inc,"++">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"else">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"c">
<CloseParenthese,")">
<Identifier,"inode">
<Assign,"=">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"pwd">
<Semicolon,";">
<Identifier,"else">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_count">
<Inc,"++">
<Semicolon,";">
<Keyword,"while">
<OpenParenthese,"(">
<Integer,"1">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"thisname">
<Assign,"=">
<Identifier,"pathname">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"S_ISDIR">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<CloseParenthese,")">
<LogicOr,"||">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"inode">
<Comma,",">
<Identifier,"MAY_EXEC">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"for">
<OpenParenthese,"(">
<Identifier,"namelen">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<OpenParenthese,"(">
<Identifier,"c">
<Assign,"=">
<Identifier,"get_fs_byte">
<OpenParenthese,"(">
<Identifier,"pathname">
<Inc,"++">
<CloseParenthese,")">
<CloseParenthese,")">
<LogicAnd,"&&">
<OpenParenthese,"(">
<Identifier,"c">
<NotEqual,"!=">
<Char,"/">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"namelen">
<Inc,"++">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"c">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"inode">
<Comma,",">
<Identifier,"thisname">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inr">
<Assign,"=">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Semicolon,";">
<Identifier,"idev">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"inode">
<Assign,"=">
<Identifier,"iget">
<OpenParenthese,"(">
<Identifier,"idev">
<Comma,",">
<Identifier,"inr">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<CloseBrace,"}">
<CloseBrace,"}">
<Keyword,"static">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"pathname">
<Comma,",">
<Keyword,"int">
<Mul,"*">
<Identifier,"namelen">
<Comma,",">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Mul,"*">
<Identifier,"name">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"char">
<Identifier,"c">
<Semicolon,";">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir">
<Assign,"=">
<Identifier,"get_dir">
<OpenParenthese,"(">
<Identifier,"pathname">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Identifier,"basename">
<Assign,"=">
<Identifier,"pathname">
<Semicolon,";">
<Keyword,"while">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Identifier,"c">
<Assign,"=">
<Identifier,"get_fs_byte">
<OpenParenthese,"(">
<Identifier,"pathname">
<Inc,"++">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"c">
<Equal,"==">
<Char,"/">
<CloseParenthese,")">
<Identifier,"basename">
<Assign,"=">
<Identifier,"pathname">
<Semicolon,";">
<Mul,"*">
<Identifier,"namelen">
<Assign,"=">
<Identifier,"pathname">
<Sub,"-">
<Identifier,"basename">
<Sub,"-">
<Integer,"1">
<Semicolon,";">
<Mul,"*">
<Identifier,"name">
<Assign,"=">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"return">
<Identifier,"dir">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"namei">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"pathname">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"int">
<Identifier,"inr">
<Comma,",">
<Identifier,"dev">
<Comma,",">
<Identifier,"namelen">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"int">
<Identifier,"i">
<Assign,"=">
<BitReverse,"~">
<Integer,"6">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir">
<Assign,"=">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Identifier,"pathname">
<Comma,",">
<BitAnd,"&">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"basename">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<Keyword,"return">
<Identifier,"dir">
<Semicolon,";">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Identifier,"NULL">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inr">
<Assign,"=">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Semicolon,";">
<Identifier,"dev">
<Assign,"=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"dir">
<Assign,"=">
<Identifier,"iget">
<OpenParenthese,"(">
<Identifier,"dev">
<Comma,",">
<Identifier,"inr">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_atime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"return">
<Identifier,"dir">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"int">
<Identifier,"open_namei">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"pathname">
<Comma,",">
<Keyword,"int">
<Identifier,"flag">
<Comma,",">
<Keyword,"int">
<Identifier,"mode">
<Comma,",">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Mul,"*">
<Identifier,"res_inode">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"int">
<Identifier,"inr">
<Comma,",">
<Identifier,"dev">
<Comma,",">
<Identifier,"namelen">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Mul,"*">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Identifier,"flag">
<BitAnd,"&">
<Identifier,"O_TRUNC">
<CloseParenthese,")">
<LogicAnd,"&&">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"flag">
<BitAnd,"&">
<Identifier,"O_ACCMODE">
<CloseParenthese,")">
<CloseParenthese,")">
<Identifier,"flag">
<BitOrAssign,"|=">
<Identifier,"O_WRONLY">
<Semicolon,";">
<Identifier,"mode">
<BitAndAssign,"&=">
<Integer,"0777">
<BitAnd,"&">
<BitReverse,"~">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"umask">
<Semicolon,";">
<Identifier,"mode">
<BitOrAssign,"|=">
<Identifier,"I_REGULAR">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir">
<Assign,"=">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Identifier,"pathname">
<Comma,",">
<BitAnd,"&">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"basename">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"flag">
<BitAnd,"&">
<OpenParenthese,"(">
<Identifier,"O_ACCMODE">
<BitOr,"|">
<Identifier,"O_CREAT">
<BitOr,"|">
<Identifier,"O_TRUNC">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Mul,"*">
<Identifier,"res_inode">
<Assign,"=">
<Identifier,"dir">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EISDIR">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"flag">
<BitAnd,"&">
<Identifier,"O_CREAT">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"MAY_WRITE">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EACCES">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<Assign,"=">
<Identifier,"new_inode">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"inode">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_uid">
<Assign,"=">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"euid">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<Assign,"=">
<Identifier,"mode">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"bh">
<Assign,"=">
<Identifier,"add_entry">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Dec,"--">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_num">
<Semicolon,";">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Mul,"*">
<Identifier,"res_inode">
<Assign,"=">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inr">
<Assign,"=">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Semicolon,";">
<Identifier,"dev">
<Assign,"=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"flag">
<BitAnd,"&">
<Identifier,"O_EXCL">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"EEXIST">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"inode">
<Assign,"=">
<Identifier,"iget">
<OpenParenthese,"(">
<Identifier,"dev">
<Comma,",">
<Identifier,"inr">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"EACCES">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Identifier,"S_ISDIR">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<CloseParenthese,")">
<LogicAnd,"&&">
<OpenParenthese,"(">
<Identifier,"flag">
<BitAnd,"&">
<Identifier,"O_ACCMODE">
<CloseParenthese,")">
<CloseParenthese,")">
<LogicOr,"||">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"inode">
<Comma,",">
<Identifier,"ACC_MODE">
<OpenParenthese,"(">
<Identifier,"flag">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_atime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"flag">
<BitAnd,"&">
<Identifier,"O_TRUNC">
<CloseParenthese,")">
<Identifier,"truncate">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Mul,"*">
<Identifier,"res_inode">
<Assign,"=">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"int">
<Identifier,"sys_mknod">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"filename">
<Comma,",">
<Keyword,"int">
<Identifier,"mode">
<Comma,",">
<Keyword,"int">
<Identifier,"dev">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"int">
<Identifier,"namelen">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Mul,"*">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"suser">
<OpenParenthese,"(">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir">
<Assign,"=">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Identifier,"filename">
<Comma,",">
<BitAnd,"&">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"basename">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"MAY_WRITE">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EEXIST">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<Assign,"=">
<Identifier,"new_inode">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"inode">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<Assign,"=">
<Identifier,"mode">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"S_ISBLK">
<OpenParenthese,"(">
<Identifier,"mode">
<CloseParenthese,")">
<LogicOr,"||">
<Identifier,"S_ISCHR">
<OpenParenthese,"(">
<Identifier,"mode">
<CloseParenthese,")">
<CloseParenthese,")">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<Assign,"=">
<Identifier,"dev">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mtime">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_atime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"bh">
<Assign,"=">
<Identifier,"add_entry">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_num">
<Semicolon,";">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"int">
<Identifier,"sys_mkdir">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"pathname">
<Comma,",">
<Keyword,"int">
<Identifier,"mode">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"int">
<Identifier,"namelen">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Mul,"*">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Comma,",">
<Mul,"*">
<Identifier,"dir_block">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"suser">
<OpenParenthese,"(">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir">
<Assign,"=">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Identifier,"pathname">
<Comma,",">
<BitAnd,"&">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"basename">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"MAY_WRITE">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EEXIST">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<Assign,"=">
<Identifier,"new_inode">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"inode">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_size">
<Assign,"=">
<Integer,"32">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mtime">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_atime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<Assign,"=">
<Identifier,"new_block">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Dec,"--">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir_block">
<Assign,"=">
<Identifier,"bread">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"free_block">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Dec,"--">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ERROR">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<Assign,"=">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"dir_block">
<PointerMember,"->">
<Identifier,"b_data">
<Semicolon,";">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_num">
<Semicolon,";">
<Identifier,"strcpy">
<OpenParenthese,"(">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"name">
<Comma,",">
<String,".">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"de">
<Inc,"++">
<Semicolon,";">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_num">
<Semicolon,";">
<Identifier,"strcpy">
<OpenParenthese,"(">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"name">
<Comma,",">
<String,"..">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Assign,"=">
<Integer,"2">
<Semicolon,";">
<Identifier,"dir_block">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"dir_block">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<Assign,"=">
<Identifier,"I_DIRECTORY">
<BitOr,"|">
<OpenParenthese,"(">
<Identifier,"mode">
<BitAnd,"&">
<Integer,"0777">
<BitAnd,"&">
<BitReverse,"~">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"umask">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"bh">
<Assign,"=">
<Identifier,"add_entry">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"free_block">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_num">
<Semicolon,";">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Inc,"++">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"static">
<Keyword,"int">
<Identifier,"empty_dir">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"inode">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"int">
<Identifier,"nr">
<Comma,",">
<Identifier,"block">
<Semicolon,";">
<Keyword,"int">
<Identifier,"len">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Identifier,"len">
<Assign,"=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_size">
<Div,"/">
<Keyword,"sizeof">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"len">
<Less,"<">
<Integer,"2">
<LogicOr,"||">
<LogicNot,"!">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<LogicOr,"||">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"bh">
<Assign,"=">
<Identifier,"bread">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_zone">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"printk">
<OpenParenthese,"(">
<String,"warning - bad directory on dev %04x\n">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<Assign,"=">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"de">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<Member,".">
<Identifier,"inode">
<NotEqual,"!=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_num">
<LogicOr,"||">
<LogicNot,"!">
<Identifier,"de">
<OpenSquareBracket,"[">
<Integer,"1">
<CloseSquareBracket,"]">
<Member,".">
<Identifier,"inode">
<LogicOr,"||">
<Identifier,"strcmp">
<OpenParenthese,"(">
<String,".">
<Comma,",">
<Identifier,"de">
<OpenSquareBracket,"[">
<Integer,"0">
<CloseSquareBracket,"]">
<Member,".">
<Identifier,"name">
<CloseParenthese,")">
<LogicOr,"||">
<Identifier,"strcmp">
<OpenParenthese,"(">
<String,"..">
<Comma,",">
<Identifier,"de">
<OpenSquareBracket,"[">
<Integer,"1">
<CloseSquareBracket,"]">
<Member,".">
<Identifier,"name">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"printk">
<OpenParenthese,"(">
<String,"warning - bad directory on dev %04x\n">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"nr">
<Assign,"=">
<Integer,"2">
<Semicolon,";">
<Identifier,"de">
<AddAssign,"+=">
<Integer,"2">
<Semicolon,";">
<Keyword,"while">
<OpenParenthese,"(">
<Identifier,"nr">
<Less,"<">
<Identifier,"len">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Keyword,"void">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"de">
<LargerEqual,">=">
<OpenParenthese,"(">
<Keyword,"void">
<Mul,"*">
<CloseParenthese,")">
<OpenParenthese,"(">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<Add,"+">
<Identifier,"BLOCK_SIZE">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"block">
<Assign,"=">
<Identifier,"bmap">
<OpenParenthese,"(">
<Identifier,"inode">
<Comma,",">
<Identifier,"nr">
<Div,"/">
<Identifier,"DIR_ENTRIES_PER_BLOCK">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"block">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"nr">
<AddAssign,"+=">
<Identifier,"DIR_ENTRIES_PER_BLOCK">
<Semicolon,";">
<Keyword,"continue">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"bh">
<Assign,"=">
<Identifier,"bread">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"block">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<Identifier,"de">
<Assign,"=">
<OpenParenthese,"(">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<CloseParenthese,")">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_data">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<Inc,"++">
<Semicolon,";">
<Identifier,"nr">
<Inc,"++">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"1">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"int">
<Identifier,"sys_rmdir">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"name">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"int">
<Identifier,"namelen">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Mul,"*">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"suser">
<OpenParenthese,"(">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir">
<Assign,"=">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Identifier,"name">
<Comma,",">
<BitAnd,"&">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"basename">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"MAY_WRITE">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"inode">
<Assign,"=">
<Identifier,"iget">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_mode">
<BitAnd,"&">
<Identifier,"S_ISVTX">
<CloseParenthese,")">
<LogicAnd,"&&">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"euid">
<LogicAnd,"&&">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_uid">
<NotEqual,"!=">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"euid">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<NotEqual,"!=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<LogicOr,"||">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_count">
<Larger,">">
<Integer,"1">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"inode">
<Equal,"==">
<Identifier,"dir">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"S_ISDIR">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOTDIR">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"empty_dir">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOTEMPTY">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<NotEqual,"!=">
<Integer,"2">
<CloseParenthese,")">
<Identifier,"printk">
<OpenParenthese,"(">
<String,"empty directory has nlink!=2 (%d)">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Dec,"--">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_ctime">
<Assign,"=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_mtime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"int">
<Identifier,"sys_unlink">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"name">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"int">
<Identifier,"namelen">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"dir">
<Comma,",">
<Mul,"*">
<Identifier,"inode">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"dir">
<Assign,"=">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Identifier,"name">
<Comma,",">
<BitAnd,"&">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"basename">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"MAY_WRITE">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<OpenParenthese,"(">
<Identifier,"inode">
<Assign,"=">
<Identifier,"iget">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<CloseParenthese,")">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_mode">
<BitAnd,"&">
<Identifier,"S_ISVTX">
<CloseParenthese,")">
<LogicAnd,"&&">
<LogicNot,"!">
<Identifier,"suser">
<OpenParenthese,"(">
<CloseParenthese,")">
<LogicAnd,"&&">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"euid">
<NotEqual,"!=">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_uid">
<LogicAnd,"&&">
<Identifier,"current">
<PointerMember,"->">
<Identifier,"euid">
<NotEqual,"!=">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_uid">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"S_ISDIR">
<OpenParenthese,"(">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_mode">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"printk">
<OpenParenthese,"(">
<String,"Deleting nonexistent file (%04x:%d), %d\n">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dev">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_num">
<Comma,",">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Integer,"0">
<Semicolon,";">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Dec,"--">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"inode">
<PointerMember,"->">
<Identifier,"i_ctime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"inode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"int">
<Identifier,"sys_link">
<OpenParenthese,"(">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"oldname">
<Comma,",">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"newname">
<CloseParenthese,")">
<OpenBrace,"{">
<Keyword,"struct">
<Identifier,"dir_entry">
<Mul,"*">
<Identifier,"de">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"m_inode">
<Mul,"*">
<Identifier,"oldinode">
<Comma,",">
<Mul,"*">
<Identifier,"dir">
<Semicolon,";">
<Keyword,"struct">
<Identifier,"buffer_head">
<Mul,"*">
<Identifier,"bh">
<Semicolon,";">
<Keyword,"const">
<Keyword,"char">
<Mul,"*">
<Identifier,"basename">
<Semicolon,";">
<Keyword,"int">
<Identifier,"namelen">
<Semicolon,";">
<Identifier,"oldinode">
<Assign,"=">
<Identifier,"namei">
<OpenParenthese,"(">
<Identifier,"oldname">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"oldinode">
<CloseParenthese,")">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOENT">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"S_ISDIR">
<OpenParenthese,"(">
<Identifier,"oldinode">
<PointerMember,"->">
<Identifier,"i_mode">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"dir">
<Assign,"=">
<Identifier,"dir_namei">
<OpenParenthese,"(">
<Identifier,"newname">
<Comma,",">
<BitAnd,"&">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"basename">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"dir">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EACCES">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"namelen">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EPERM">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"dir">
<PointerMember,"->">
<Identifier,"i_dev">
<NotEqual,"!=">
<Identifier,"oldinode">
<PointerMember,"->">
<Identifier,"i_dev">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EXDEV">
<Semicolon,";">
<CloseBrace,"}">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"permission">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"MAY_WRITE">
<CloseParenthese,")">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EACCES">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"bh">
<Assign,"=">
<Identifier,"find_entry">
<OpenParenthese,"(">
<BitAnd,"&">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"EEXIST">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"bh">
<Assign,"=">
<Identifier,"add_entry">
<OpenParenthese,"(">
<Identifier,"dir">
<Comma,",">
<Identifier,"basename">
<Comma,",">
<Identifier,"namelen">
<Comma,",">
<BitAnd,"&">
<Identifier,"de">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"if">
<OpenParenthese,"(">
<LogicNot,"!">
<Identifier,"bh">
<CloseParenthese,")">
<OpenBrace,"{">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Sub,"-">
<Identifier,"ENOSPC">
<Semicolon,";">
<CloseBrace,"}">
<Identifier,"de">
<PointerMember,"->">
<Identifier,"inode">
<Assign,"=">
<Identifier,"oldinode">
<PointerMember,"->">
<Identifier,"i_num">
<Semicolon,";">
<Identifier,"bh">
<PointerMember,"->">
<Identifier,"b_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"brelse">
<OpenParenthese,"(">
<Identifier,"bh">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"dir">
<CloseParenthese,")">
<Semicolon,";">
<Identifier,"oldinode">
<PointerMember,"->">
<Identifier,"i_nlinks">
<Inc,"++">
<Semicolon,";">
<Identifier,"oldinode">
<PointerMember,"->">
<Identifier,"i_ctime">
<Assign,"=">
<Identifier,"CURRENT_TIME">
<Semicolon,";">
<Identifier,"oldinode">
<PointerMember,"->">
<Identifier,"i_dirt">
<Assign,"=">
<Integer,"1">
<Semicolon,";">
<Identifier,"iput">
<OpenParenthese,"(">
<Identifier,"oldinode">
<CloseParenthese,")">
<Semicolon,";">
<Keyword,"return">
<Integer,"0">
<Semicolon,";">
<CloseBrace,"}">
